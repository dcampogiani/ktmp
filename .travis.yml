matrix:
  include:
    - language: android
      os: linux
      jdk: oraclejdk8
      android:
        components:
          - tools
          - platform-tools
          - build-tools-29.0.3
          - android-29
      before_install:
        - yes | sdkmanager tools
      before_script:
        - chmod +x gradlew
      script:
        - ./gradlew common:build --no-daemon --console plain
        - ./gradlew app:testDebugUnitTest app:assembleDebug --no-daemon --console plain
      before_cache:
        - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
        - rm -fr $HOME/.gradle/caches/*/plugin-resolution/
      cache:
        directories:
          - $HOME/.gradle/caches/
          - $HOME/.gradle/wrapper/
          - $HOME/.android/build-cache
    - language: swift
      os: osx
      osx_image: xcode11.3.1
      script:
        - ./gradlew common:build --console plain
        - cd native/KotlinIOS
        - xcodebuild \
          -project KotlinIOS.xcodeproj \
          -scheme KotlinIOS \
          -destination 'platform=iOS Simulator,name=iPhone 11 Pro Max,OS=13.4.1' \
          test | xcpretty --test --color
      after_failure:
        - cat xcodebuild.log
